<html>
  <head>
    <meta charset="UTF-8">
    <title>tutorial - Neptune-notebook.js</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <style>
      /* neptune.css */
      /*
 * General styling
 */
* {
  box-sizing: border-box;
}

body {
  padding: 50px;
}

/*
 * Tabs layout
 * https://kyusuf.com/post/completely-css-tabs/
 */
.code-tabs {
  /* box-shadow: 0 48px 80px -32px rgba(0,0,0,0.3); */
  padding-top: 20px;
}
.tab-input {
  position: absolute;
  opacity: 0;
}
.tab-label {
  border-radius: 10px 10px 0 0;
  width: 100%;
  padding: 20px 30px;
  background: #e5e5e5;
  cursor: pointer;
  font-weight: bold;
  font-size: 18px;
  color: #7f7f7f;
  transition background 0.1s, color 0.1s;

}
.tab-label-selected {
  background: rgb(45, 45, 45);
  color: #FFFFFF;
}
.tab-label:hover {
  color: #4CAF50;
}
.code-tab {
  display: none;
}
.tab-input:checked + .code-tab {
  display: block;
}

/*
 * Code editor
 * Use a "transparent" <textarea> super-imposed right on top of <code> in parent <pre>
 */
.code-editor {
  /* overlay this perfectly on top of code */
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  width: 100%;
  height: calc(100% - 1px);

  /* Make sure nothing is visible from this text area */
  border: none;
  overflow: hidden;
  resize: none;
  background-color: transparent;
  color: transparent;
  caret-color: white;
  
  /* have the same exact font as <code> */
  font-family: Consolas, Monaco, "Andale Mono", "Ubuntu Mono", monospace;
  font-size: 16px;
  line-height: 24px;
  overflow-wrap: normal;
  text-align: left;
  word-break: normal;
  word-spacing: 0px;
  -moz-tab-size: 4;

  /* have the same padding as <code> (due to line numbers) */
  padding-left: 3.8em;
  padding-right: 1em;
  padding-top: 1em;
  padding-bottom: 1em;
}

.code-tab pre {
  min-height: 80px;
  overflow: hidden;
}

/*
 * bar with execute button 
 * https://www.w3schools.com/howto/howto_css_icon_bar.asp
 */
.code-toolbar {
  position: relative;
  text-align: right;
  z-index: 2;
  background-color: transparent;
  padding-top: 5px;
  margin-top: 20px;
  width: 150px;
  left: calc(100% - 150px);
}

.code-tab pre {  /* move <pre> up to be level with toolbar */
  position: relative;
  top: -60px;
  z-index: 1;
}

.code-tabs { /* undo placement error from top: -60px */
  margin-top: 20px;
  margin-bottom: -60px;
  overflow: hidden;
}

.code-toolbar a {
  text-align: center;
  padding: 10px;
  transition: all 0.3s ease;
  color: white;
  font-size: 30px;
  z-index: 2;
}

.code-toolbar a:hover {
  background-color: #4CAF50;
}

.code-toolbar a {
  background-color: rgb(45, 45, 45);
}

/*
 * output terminal like panel
 */
.output-panel {
  display: none;
}

    </style>
    <style>
      /* prism.css */
      /* PrismJS 1.17.1
https://prismjs.com/download.html#themes=prism-tomorrow&languages=clike+javascript&plugins=line-highlight+line-numbers+autolinker+command-line+match-braces */
/**
 * prism.js tomorrow night eighties for JavaScript, CoffeeScript, CSS and HTML
 * Based on https://github.com/chriskempson/tomorrow-theme
 * @author Rose Pritchard
 */

code[class*="language-"],
pre[class*="language-"] {
	color: #ccc;
	background: none;
	font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
	font-size: 1em;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	word-wrap: normal;
	line-height: 1.5;

	-moz-tab-size: 4;
	-o-tab-size: 4;
	tab-size: 4;

	-webkit-hyphens: none;
	-moz-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;

}

/* Code blocks */
pre[class*="language-"] {
	padding: 1em;
	margin: .5em 0;
	overflow: auto;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
	background: #2d2d2d;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
	padding: .1em;
	border-radius: .3em;
	white-space: normal;
}

.token.comment,
.token.block-comment,
.token.prolog,
.token.doctype,
.token.cdata {
	color: #999;
}

.token.punctuation {
	color: #ccc;
}

.token.tag,
.token.attr-name,
.token.namespace,
.token.deleted {
	color: #e2777a;
}

.token.function-name {
	color: #6196cc;
}

.token.boolean,
.token.number,
.token.function {
	color: #f08d49;
}

.token.property,
.token.class-name,
.token.constant,
.token.symbol {
	color: #f8c555;
}

.token.selector,
.token.important,
.token.atrule,
.token.keyword,
.token.builtin {
	color: #cc99cd;
}

.token.string,
.token.char,
.token.attr-value,
.token.regex,
.token.variable {
	color: #7ec699;
}

.token.operator,
.token.entity,
.token.url {
	color: #67cdcc;
}

.token.important,
.token.bold {
	font-weight: bold;
}
.token.italic {
	font-style: italic;
}

.token.entity {
	cursor: help;
}

.token.inserted {
	color: green;
}

pre[data-line] {
	position: relative;
	padding: 1em 0 1em 3em;
}

.line-highlight {
	position: absolute;
	left: 0;
	right: 0;
	padding: inherit 0;
	margin-top: 1em; /* Same as .prismâ€™s padding-top */

	background: hsla(24, 20%, 50%,.08);
	background: linear-gradient(to right, hsla(24, 20%, 50%,.1) 70%, hsla(24, 20%, 50%,0));

	pointer-events: none;

	line-height: inherit;
	white-space: pre;
}

	.line-highlight:before,
	.line-highlight[data-end]:after {
		content: attr(data-start);
		position: absolute;
		top: .4em;
		left: .6em;
		min-width: 1em;
		padding: 0 .5em;
		background-color: hsla(24, 20%, 50%,.4);
		color: hsl(24, 20%, 95%);
		font: bold 65%/1.5 sans-serif;
		text-align: center;
		vertical-align: .3em;
		border-radius: 999px;
		text-shadow: none;
		box-shadow: 0 1px white;
	}

	.line-highlight[data-end]:after {
		content: attr(data-end);
		top: auto;
		bottom: .4em;
	}

.line-numbers .line-highlight:before,
.line-numbers .line-highlight:after {
	content: none;
}

pre[class*="language-"].line-numbers {
	position: relative;
	padding-left: 3.8em;
	counter-reset: linenumber;
}

pre[class*="language-"].line-numbers > code {
	position: relative;
	white-space: inherit;
}

.line-numbers .line-numbers-rows {
	position: absolute;
	pointer-events: none;
	top: 0;
	font-size: 100%;
	left: -3.8em;
	width: 3em; /* works for line-numbers below 1000 lines */
	letter-spacing: -1px;
	border-right: 1px solid #999;

	-webkit-user-select: none;
	-moz-user-select: none;
	-ms-user-select: none;
	user-select: none;

}

	.line-numbers-rows > span {
		pointer-events: none;
		display: block;
		counter-increment: linenumber;
	}

		.line-numbers-rows > span:before {
			content: counter(linenumber);
			color: #999;
			display: block;
			padding-right: 0.8em;
			text-align: right;
		}

.token a {
	color: inherit;
}
.command-line-prompt {
	border-right: 1px solid #999;
	display: block;
	float: left;
	font-size: 100%;
	letter-spacing: -1px;
	margin-right: 1em;
	pointer-events: none;

	-webkit-user-select: none;
	-moz-user-select: none;
	-ms-user-select: none;
	user-select: none;
}

.command-line-prompt > span:before {
	color: #999;
	content: ' ';
	display: block;
	padding-right: 0.8em;
}

.command-line-prompt > span[data-user]:before {
	content: "[" attr(data-user) "@" attr(data-host) "] $";
}

.command-line-prompt > span[data-user="root"]:before {
	content: "[" attr(data-user) "@" attr(data-host) "] #";
}

.command-line-prompt > span[data-prompt]:before {
	content: attr(data-prompt);
}

.token.punctuation.brace-hover,
.token.punctuation.brace-selected {
	outline: solid 1px;
}

.rainbow-braces .token.punctuation.brace-level-1,
.rainbow-braces .token.punctuation.brace-level-5,
.rainbow-braces .token.punctuation.brace-level-9 {
	color: #E50;
	opacity: 1;
}
.rainbow-braces .token.punctuation.brace-level-2,
.rainbow-braces .token.punctuation.brace-level-6,
.rainbow-braces .token.punctuation.brace-level-10 {
	color: #0B3;
	opacity: 1;
}
.rainbow-braces .token.punctuation.brace-level-3,
.rainbow-braces .token.punctuation.brace-level-7,
.rainbow-braces .token.punctuation.brace-level-11 {
	color: #26F;
	opacity: 1;
}
.rainbow-braces .token.punctuation.brace-level-4,
.rainbow-braces .token.punctuation.brace-level-8,
.rainbow-braces .token.punctuation.brace-level-12 {
	color: #E0E;
	opacity: 1;
}


    </style>
  </head>
  <body>
    <h1 id="standarddeviationundermpc">Standard Deviation under MPC</h1>
<p>Say you and your friends have just gotten back a brutal exam. Everyone says they did terribly on it, and you want to
commiserate together. But some of your friends are huge over-achievers, and probably would say that they did poorly if
they got an A-. You got a failing grade, and don't want to tell anyone else unless their grades were sufficiently close
to yours. So, everyone decides to compute the standard deviations of your grades under MPC. Then, based on that
standard deviation, you can decide whether or not you want to share your grades with each other.</p>
<p>In this tutorial, we'll look at an efficient implementation of the standard deviation for floating-point numbers. We will focus on the client-side code. For details on the server side, check out the complete files in the /demos/standard-deviation directory.</p>
<h1 id="implementingclientcode">Implementing client code</h1>
<p>In this setting, we want to compute a standard deviation, assume each individual has a single input value. Each party's
input, which in the trivial implementation will be an integer. As before, the client program has two jobs: they connect
to the server, and they work together to compute the standard deviation under MPC. In the initial implementation, which
only supports integer operations, there will be some accuracy loss due to rounding to integers throughout the
computation. These accuracy losses will be minimized with the extension to floating point arithmetic.o</p>
<h2 id="connectingtotheserver">Connecting to the server</h2>
<p>In the file <code>client.js</code>, we start by connecting to the server. First, we define the <code>hostname</code> that the server above is
running on. Second, since this is a multi-party computation, we need to tell the server how many parties there are
(<code>party_count</code>), and the name of our computation(<code>computation_id</code>).</p>
<p>The <code>make_jiff</code> function uses this information to set up a new JIFF object.
We save the fully configured <code>jiff_instance</code> in a global variable, so we can use it when we compute our function.</p>
<pre><code class="neptune[title=Party&nbsp1] language-neptune[title=Party&nbsp1]">var jiff_instance;

function connect() {

  var hostname = "http://localhost:8080";

  var computation_id = 'stand_dev';
  var options = {party_count: 3};

  // TODO: is this necessary if we're using npm?
  if (node) {
    jiff = require('../../lib/jiff-client');
    $ = require('jquery-deferred');
  }

  jiff_instance = jiff.make_jiff(hostname, computation_id, options);
}
</code></pre>
<h2 id="computingthestandarddeviation">Computing the standard deviation</h2>
<p>Say there are <em>n</em> parties in your computation, each with input <em>x<em>i</em>. Let <em>m</em> be the mean of the inputs <em>x</em>i</em>. Recall
that the (population) variance of a series of values is defined to be the sum between <em>i=1</em> and <em>n</em> of
<em>(1/n)(x_i - m)^2</em>. The standard deviation is then the square root of the variance.</p>
<p>We could choose to compute this expression directly under MPC by secret-sharing the <em>x_i</em> values, subtracting the mean
from them, and squaring this and then summing, normalizing by <em>n</em>, and taking the square root, all under MPC. However,
this will be both messy to write and inefficient: any multiplication done under MPC is time-intensive, and here there
are many.</p>
<p>There are a few things we can do to cut down on the computational overhead. First, note that the variance is really what
needs to be computed under MPC: the value of <em>n</em> is public so we can derive the standard deviation from the variance
publicly without incurring any additional privacy loss.</p>
<p>Secondly, one can recall that there is an alternate formulation of the variance, which is</p>
<p><em>E[X]^2 - E[X^2],</em></p>
<p>where <em>E</em> denotes the expected value, i.e. variance is equal to the difference between the square of the
mean of the input values and the mean of the input values squared.</p>
<p>We can make this slightly faster by moving some of the normalization to post-processing, i.e. writing variance as</p>
<p><em>(1/n)[(sum over X)^2/n - (sum over X^2)].</em></p>
<p>Thus, variance can be calculated by each user
locally computing the square of their value, then secret sharing both their value and their value squared to compute the
means of both. Since <em>n</em> is a constant, the multiplication by <em>1/n</em> to compute the means is computationally inexpensive,
there is only one single secure multiplication that must take place, when <em>E[X]</em> is squared.</p>
<p>In code, here is an outline of what we will do given each party's arbitrary input value <em>x_i</em> and number of parties <em>n</em>.</p>
<pre><code class="javascript language-javascript">function compute() {
  var x_i; //input: will be passed into computation in final version
  var n;   //number of parties: will be passed into computation in final version

  // calculate x_i^2
  ...
  // share x_i and x_i^2
  ...
  // secretly compute sum of x_i's
  ...
  // secretly compute sum of x_i^2's
  ...
  // square the sum of x^i's
  ...
  // normalize the square of the sum of x_i's
  ...
  // subtract the sum of x_i^2's from this
  ...
  // open the results
  ...
  // normalize the result
  ...
  // Take the square root of this
  ...
  // print this final result
  ...
}
</code></pre>
<p>The first step is to share our input and our input squared with the rest of the parties. We use our saved and configured
 <code>jiff_instance</code> to do so. This operation is asynchronous: it requires communicating with every party to secret share
 the data. It returns a promise.</p>
<p>The sharing function is passed the input. In this case, all party inputs are length one, and they're all providing the
same type of input. These items are customizable, but in this case the basic implementation is sufficient.</p>
<pre><code class="javascript language-javascript"> var shares = jiff_instance.share(input);
 var in_squared = jiff_instance.share(input**2);
</code></pre>
<p>However, since the input squared might have more decimal points than the original input and we are restricted to some
fixed number of decimal points depending on our settings, the <code>in_squared</code> variable first needs to have input**2
truncated to that number of decimal points. Say we want to truncate to 2 decimal points. Then,</p>
<pre><code class="javascript language-javascript">var in_squared_fixed = Number.parseFloat((Math.pow(input, 2)).toFixed(2)); //convert input^2 to fixed point number
var in_squared = jiff_instance.share(in_squared_fixed);
</code></pre>
<p>Once everyone's input is shared, we'll compute their sums. The promises that <code>shares</code> and <code>in_squared</code> return are
objects containing the shares from every party in an object. They have the form</p>
<pre><code>{1 : [&lt;party 1's array&gt;], 2 : [&lt;party 2's array&gt;], n: [&lt;party n's array&gt;]}
</code></pre>
<p>To sum the secret-shares, we use the secret addition function, <code>sadd</code></p>
<pre><code class="javascript language-javascript">var in_sum = shares[1];
var in_squared_sum = in_squared[1];

for (var i = 2; i &lt;= jiff_instance.party_count; i++) {    // sum all inputs and sum all inputs squared
      in_sum = in_sum.sadd(shares[i]);
      in_squared_sum = in_squared_sum.sadd(in_squared[i]);
    }
</code></pre>
<p>Next, we need to normalize the sum of the inputs. Since <em>1/n</em> may as a floating point number have more values after the
decimal than our settings can handle, we first truncate this to a fixed amount and then do a secret multiplication by this.</p>
<pre><code class="javascript language-javascript"> var one_over_n = Number.parseFloat((1/jiff_instance.party_count).toFixed(2)); // convert 1/n to fixed point number
 var in_sum_squared = in_sum.smult(in_sum);
 var intermediary = in_sum_squared.cmult(one_over_n);
</code></pre>
<p>We can then compute the difference between this and the sum of inputs squared.</p>
<pre><code class="javascript language-javascript">var out = in_squared_sum.ssub(intermediary);
</code></pre>
<p>Finally, we need to reveal the results to each party. We use a promise to resolve the results
from all parties, then do the final post-processing on this reveal.</p>
<pre><code class="javascript language-javascript">//Create a promise of output
var promise = jiff_instance.open(out);

var promise2 = promise.then(function (v) {
  var variance = v/(jiff_instance.party_count - 1);
  return Math.sqrt(variance);       // Return standard deviation.
});
</code></pre>
<p>The <code>compute</code> function looks like this:</p>
<pre><code class="javascript language-javascript">function compute() {
    var shares = jiff_instance.share(input);
    var in_sum = shares[1];
    var in_squared_fixed = Number.parseFloat((Math.pow(input, 2)).toFixed(2)); //convert input^2 to fixed point number
    var in_squared = jiff_instance.share(in_squared_fixed);
    var in_squared_sum = in_squared[1];

    for (var i = 2; i &lt;= jiff_instance.party_count; i++) {    // sum all inputs and sum all inputs squared
      in_sum = in_sum.sadd(shares[i]);
      in_squared_sum = in_squared_sum.sadd(in_squared[i]);
    }

    var one_over_n = Number.parseFloat((1/jiff_instance.party_count).toFixed(2)); // convert 1/n to fixed point number
    var in_sum_squared = in_sum.smult(in_sum);
    var intermediary = in_sum_squared.cmult(one_over_n);
    var out = in_squared_sum.ssub(intermediary);


    //Create a promise of output
    var promise = jiff_instance.open(out);

    var promise2 = promise.then(function (v) {
      var variance = v/(jiff_instance.party_count - 1);
      return Math.sqrt(variance);       // Return standard deviation.
    });

    return promise2;

}
</code></pre>
<h1 id="completefiles">Complete Files</h1>
<p>For complete files and running instructions, navigate to /demos/standard-deviation.</p>

    <script type="text/javascript">
      // prism.js
      /* PrismJS 1.17.1
https://prismjs.com/download.html#themes=prism-tomorrow&languages=clike+javascript&plugins=line-highlight+line-numbers+autolinker+command-line+match-braces */
var _self="undefined"!=typeof window?window:"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?self:{},Prism=function(u){var c=/\blang(?:uage)?-([\w-]+)\b/i,a=0;var _={manual:u.Prism&&u.Prism.manual,disableWorkerMessageHandler:u.Prism&&u.Prism.disableWorkerMessageHandler,util:{encode:function(e){return e instanceof L?new L(e.type,_.util.encode(e.content),e.alias):Array.isArray(e)?e.map(_.util.encode):e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/\u00a0/g," ")},type:function(e){return Object.prototype.toString.call(e).slice(8,-1)},objId:function(e){return e.__id||Object.defineProperty(e,"__id",{value:++a}),e.__id},clone:function n(e,r){var t,a,i=_.util.type(e);switch(r=r||{},i){case"Object":if(a=_.util.objId(e),r[a])return r[a];for(var o in t={},r[a]=t,e)e.hasOwnProperty(o)&&(t[o]=n(e[o],r));return t;case"Array":return a=_.util.objId(e),r[a]?r[a]:(t=[],r[a]=t,e.forEach(function(e,a){t[a]=n(e,r)}),t);default:return e}}},languages:{extend:function(e,a){var n=_.util.clone(_.languages[e]);for(var r in a)n[r]=a[r];return n},insertBefore:function(n,e,a,r){var t=(r=r||_.languages)[n],i={};for(var o in t)if(t.hasOwnProperty(o)){if(o==e)for(var l in a)a.hasOwnProperty(l)&&(i[l]=a[l]);a.hasOwnProperty(o)||(i[o]=t[o])}var s=r[n];return r[n]=i,_.languages.DFS(_.languages,function(e,a){a===s&&e!=n&&(this[e]=i)}),i},DFS:function e(a,n,r,t){t=t||{};var i=_.util.objId;for(var o in a)if(a.hasOwnProperty(o)){n.call(a,o,a[o],r||o);var l=a[o],s=_.util.type(l);"Object"!==s||t[i(l)]?"Array"!==s||t[i(l)]||(t[i(l)]=!0,e(l,n,o,t)):(t[i(l)]=!0,e(l,n,null,t))}}},plugins:{},highlightAll:function(e,a){_.highlightAllUnder(document,e,a)},highlightAllUnder:function(e,a,n){var r={callback:n,selector:'code[class*="language-"], [class*="language-"] code, code[class*="lang-"], [class*="lang-"] code'};_.hooks.run("before-highlightall",r);for(var t,i=e.querySelectorAll(r.selector),o=0;t=i[o++];)_.highlightElement(t,!0===a,r.callback)},highlightElement:function(e,a,n){var r=function(e){for(;e&&!c.test(e.className);)e=e.parentNode;return e?(e.className.match(c)||[,"none"])[1].toLowerCase():"none"}(e),t=_.languages[r];e.className=e.className.replace(c,"").replace(/\s+/g," ")+" language-"+r;var i=e.parentNode;i&&"pre"===i.nodeName.toLowerCase()&&(i.className=i.className.replace(c,"").replace(/\s+/g," ")+" language-"+r);var o={element:e,language:r,grammar:t,code:e.textContent};function l(e){o.highlightedCode=e,_.hooks.run("before-insert",o),o.element.innerHTML=o.highlightedCode,_.hooks.run("after-highlight",o),_.hooks.run("complete",o),n&&n.call(o.element)}if(_.hooks.run("before-sanity-check",o),!o.code)return _.hooks.run("complete",o),void(n&&n.call(o.element));if(_.hooks.run("before-highlight",o),o.grammar)if(a&&u.Worker){var s=new Worker(_.filename);s.onmessage=function(e){l(e.data)},s.postMessage(JSON.stringify({language:o.language,code:o.code,immediateClose:!0}))}else l(_.highlight(o.code,o.grammar,o.language));else l(_.util.encode(o.code))},highlight:function(e,a,n){var r={code:e,grammar:a,language:n};return _.hooks.run("before-tokenize",r),r.tokens=_.tokenize(r.code,r.grammar),_.hooks.run("after-tokenize",r),L.stringify(_.util.encode(r.tokens),r.language)},matchGrammar:function(e,a,n,r,t,i,o){for(var l in n)if(n.hasOwnProperty(l)&&n[l]){var s=n[l];s=Array.isArray(s)?s:[s];for(var u=0;u<s.length;++u){if(o&&o==l+","+u)return;var c=s[u],g=c.inside,f=!!c.lookbehind,h=!!c.greedy,d=0,m=c.alias;if(h&&!c.pattern.global){var p=c.pattern.toString().match(/[imsuy]*$/)[0];c.pattern=RegExp(c.pattern.source,p+"g")}c=c.pattern||c;for(var y=r,v=t;y<a.length;v+=a[y].length,++y){var k=a[y];if(a.length>e.length)return;if(!(k instanceof L)){if(h&&y!=a.length-1){if(c.lastIndex=v,!(x=c.exec(e)))break;for(var b=x.index+(f&&x[1]?x[1].length:0),w=x.index+x[0].length,A=y,P=v,O=a.length;A<O&&(P<w||!a[A].type&&!a[A-1].greedy);++A)(P+=a[A].length)<=b&&(++y,v=P);if(a[y]instanceof L)continue;j=A-y,k=e.slice(v,P),x.index-=v}else{c.lastIndex=0;var x=c.exec(k),j=1}if(x){f&&(d=x[1]?x[1].length:0);w=(b=x.index+d)+(x=x[0].slice(d)).length;var N=k.slice(0,b),S=k.slice(w),C=[y,j];N&&(++y,v+=N.length,C.push(N));var E=new L(l,g?_.tokenize(x,g):x,m,x,h);if(C.push(E),S&&C.push(S),Array.prototype.splice.apply(a,C),1!=j&&_.matchGrammar(e,a,n,y,v,!0,l+","+u),i)break}else if(i)break}}}}},tokenize:function(e,a){var n=[e],r=a.rest;if(r){for(var t in r)a[t]=r[t];delete a.rest}return _.matchGrammar(e,n,a,0,0,!1),n},hooks:{all:{},add:function(e,a){var n=_.hooks.all;n[e]=n[e]||[],n[e].push(a)},run:function(e,a){var n=_.hooks.all[e];if(n&&n.length)for(var r,t=0;r=n[t++];)r(a)}},Token:L};function L(e,a,n,r,t){this.type=e,this.content=a,this.alias=n,this.length=0|(r||"").length,this.greedy=!!t}if(u.Prism=_,L.stringify=function(e,a){if("string"==typeof e)return e;if(Array.isArray(e))return e.map(function(e){return L.stringify(e,a)}).join("");var n={type:e.type,content:L.stringify(e.content,a),tag:"span",classes:["token",e.type],attributes:{},language:a};if(e.alias){var r=Array.isArray(e.alias)?e.alias:[e.alias];Array.prototype.push.apply(n.classes,r)}_.hooks.run("wrap",n);var t=Object.keys(n.attributes).map(function(e){return e+'="'+(n.attributes[e]||"").replace(/"/g,"&quot;")+'"'}).join(" ");return"<"+n.tag+' class="'+n.classes.join(" ")+'"'+(t?" "+t:"")+">"+n.content+"</"+n.tag+">"},!u.document)return u.addEventListener&&(_.disableWorkerMessageHandler||u.addEventListener("message",function(e){var a=JSON.parse(e.data),n=a.language,r=a.code,t=a.immediateClose;u.postMessage(_.highlight(r,_.languages[n],n)),t&&u.close()},!1)),_;var e=document.currentScript||[].slice.call(document.getElementsByTagName("script")).pop();if(e&&(_.filename=e.src,e.hasAttribute("data-manual")&&(_.manual=!0)),!_.manual){function n(){_.manual||_.highlightAll()}"loading"!==document.readyState?window.requestAnimationFrame?window.requestAnimationFrame(n):window.setTimeout(n,16):document.addEventListener("DOMContentLoaded",n)}return _}(_self);"undefined"!=typeof module&&module.exports&&(module.exports=Prism),"undefined"!=typeof global&&(global.Prism=Prism);
Prism.languages.clike={comment:[{pattern:/(^|[^\\])\/\*[\s\S]*?(?:\*\/|$)/,lookbehind:!0},{pattern:/(^|[^\\:])\/\/.*/,lookbehind:!0,greedy:!0}],string:{pattern:/(["'])(?:\\(?:\r\n|[\s\S])|(?!\1)[^\\\r\n])*\1/,greedy:!0},"class-name":{pattern:/((?:\b(?:class|interface|extends|implements|trait|instanceof|new)\s+)|(?:catch\s+\())[\w.\\]+/i,lookbehind:!0,inside:{punctuation:/[.\\]/}},keyword:/\b(?:if|else|while|do|for|return|in|instanceof|function|new|try|throw|catch|finally|null|break|continue)\b/,boolean:/\b(?:true|false)\b/,function:/\w+(?=\()/,number:/\b0x[\da-f]+\b|(?:\b\d+\.?\d*|\B\.\d+)(?:e[+-]?\d+)?/i,operator:/--?|\+\+?|!=?=?|<=?|>=?|==?=?|&&?|\|\|?|\?|\*|\/|~|\^|%/,punctuation:/[{}[\];(),.:]/};
Prism.languages.javascript=Prism.languages.extend("clike",{"class-name":[Prism.languages.clike["class-name"],{pattern:/(^|[^$\w\xA0-\uFFFF])[_$A-Z\xA0-\uFFFF][$\w\xA0-\uFFFF]*(?=\.(?:prototype|constructor))/,lookbehind:!0}],keyword:[{pattern:/((?:^|})\s*)(?:catch|finally)\b/,lookbehind:!0},{pattern:/(^|[^.])\b(?:as|async(?=\s*(?:function\b|\(|[$\w\xA0-\uFFFF]|$))|await|break|case|class|const|continue|debugger|default|delete|do|else|enum|export|extends|for|from|function|get|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|set|static|super|switch|this|throw|try|typeof|undefined|var|void|while|with|yield)\b/,lookbehind:!0}],number:/\b(?:(?:0[xX](?:[\dA-Fa-f](?:_[\dA-Fa-f])?)+|0[bB](?:[01](?:_[01])?)+|0[oO](?:[0-7](?:_[0-7])?)+)n?|(?:\d(?:_\d)?)+n|NaN|Infinity)\b|(?:\b(?:\d(?:_\d)?)+\.?(?:\d(?:_\d)?)*|\B\.(?:\d(?:_\d)?)+)(?:[Ee][+-]?(?:\d(?:_\d)?)+)?/,function:/#?[_$a-zA-Z\xA0-\uFFFF][$\w\xA0-\uFFFF]*(?=\s*(?:\.\s*(?:apply|bind|call)\s*)?\()/,operator:/-[-=]?|\+[+=]?|!=?=?|<<?=?|>>?>?=?|=(?:==?|>)?|&[&=]?|\|[|=]?|\*\*?=?|\/=?|~|\^=?|%=?|\?|\.{3}/}),Prism.languages.javascript["class-name"][0].pattern=/(\b(?:class|interface|extends|implements|instanceof|new)\s+)[\w.\\]+/,Prism.languages.insertBefore("javascript","keyword",{regex:{pattern:/((?:^|[^$\w\xA0-\uFFFF."'\])\s])\s*)\/(\[(?:[^\]\\\r\n]|\\.)*]|\\.|[^/\\\[\r\n])+\/[gimyus]{0,6}(?=\s*($|[\r\n,.;})\]]))/,lookbehind:!0,greedy:!0},"function-variable":{pattern:/#?[_$a-zA-Z\xA0-\uFFFF][$\w\xA0-\uFFFF]*(?=\s*[=:]\s*(?:async\s*)?(?:\bfunction\b|(?:\((?:[^()]|\([^()]*\))*\)|[_$a-zA-Z\xA0-\uFFFF][$\w\xA0-\uFFFF]*)\s*=>))/,alias:"function"},parameter:[{pattern:/(function(?:\s+[_$A-Za-z\xA0-\uFFFF][$\w\xA0-\uFFFF]*)?\s*\(\s*)(?!\s)(?:[^()]|\([^()]*\))+?(?=\s*\))/,lookbehind:!0,inside:Prism.languages.javascript},{pattern:/[_$a-z\xA0-\uFFFF][$\w\xA0-\uFFFF]*(?=\s*=>)/i,inside:Prism.languages.javascript},{pattern:/(\(\s*)(?!\s)(?:[^()]|\([^()]*\))+?(?=\s*\)\s*=>)/,lookbehind:!0,inside:Prism.languages.javascript},{pattern:/((?:\b|\s|^)(?!(?:as|async|await|break|case|catch|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally|for|from|function|get|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|set|static|super|switch|this|throw|try|typeof|undefined|var|void|while|with|yield)(?![$\w\xA0-\uFFFF]))(?:[_$A-Za-z\xA0-\uFFFF][$\w\xA0-\uFFFF]*\s*)\(\s*)(?!\s)(?:[^()]|\([^()]*\))+?(?=\s*\)\s*\{)/,lookbehind:!0,inside:Prism.languages.javascript}],constant:/\b[A-Z](?:[A-Z_]|\dx?)*\b/}),Prism.languages.insertBefore("javascript","string",{"template-string":{pattern:/`(?:\\[\s\S]|\${(?:[^{}]|{(?:[^{}]|{[^}]*})*})+}|(?!\${)[^\\`])*`/,greedy:!0,inside:{"template-punctuation":{pattern:/^`|`$/,alias:"string"},interpolation:{pattern:/((?:^|[^\\])(?:\\{2})*)\${(?:[^{}]|{(?:[^{}]|{[^}]*})*})+}/,lookbehind:!0,inside:{"interpolation-punctuation":{pattern:/^\${|}$/,alias:"punctuation"},rest:Prism.languages.javascript}},string:/[\s\S]+/}}}),Prism.languages.markup&&Prism.languages.markup.tag.addInlined("script","javascript"),Prism.languages.js=Prism.languages.javascript;
!function(){if("undefined"!=typeof self&&self.Prism&&self.document&&document.querySelector){var t,n=function(){if(void 0===t){var e=document.createElement("div");e.style.fontSize="13px",e.style.lineHeight="1.5",e.style.padding=0,e.style.border=0,e.innerHTML="&nbsp;<br />&nbsp;",document.body.appendChild(e),t=38===e.offsetHeight,document.body.removeChild(e)}return t},a=0;Prism.hooks.add("before-sanity-check",function(e){var t=e.element.parentNode,n=t&&t.getAttribute("data-line");if(t&&n&&/pre/i.test(t.nodeName)){var i=0;r(".line-highlight",t).forEach(function(e){i+=e.textContent.length,e.parentNode.removeChild(e)}),i&&/^( \n)+$/.test(e.code.slice(-i))&&(e.code=e.code.slice(0,-i))}}),Prism.hooks.add("complete",function e(t){var n=t.element.parentNode,i=n&&n.getAttribute("data-line");if(n&&i&&/pre/i.test(n.nodeName)){clearTimeout(a);var r=Prism.plugins.lineNumbers,o=t.plugins&&t.plugins.lineNumbers;if(l(n,"line-numbers")&&r&&!o)Prism.hooks.add("line-numbers",e);else s(n,i)(),a=setTimeout(u,1)}}),window.addEventListener("hashchange",u),window.addEventListener("resize",function(){var t=[];r("pre[data-line]").forEach(function(e){t.push(s(e))}),t.forEach(i)})}function r(e,t){return Array.prototype.slice.call((t||document).querySelectorAll(e))}function l(e,t){return t=" "+t+" ",-1<(" "+e.className+" ").replace(/[\n\t]/g," ").indexOf(t)}function i(e){e()}function s(u,e,d){var t=(e="string"==typeof e?e:u.getAttribute("data-line")).replace(/\s+/g,"").split(","),c=+u.getAttribute("data-line-offset")||0,f=(n()?parseInt:parseFloat)(getComputedStyle(u).lineHeight),h=l(u,"line-numbers"),p=h?u:u.querySelector("code")||u,m=[];return t.forEach(function(e){var t=e.split("-"),n=+t[0],i=+t[1]||n,r=u.querySelector('.line-highlight[data-range="'+e+'"]')||document.createElement("div");if(m.push(function(){r.setAttribute("aria-hidden","true"),r.setAttribute("data-range",e),r.className=(d||"")+" line-highlight"}),h&&Prism.plugins.lineNumbers){var o=Prism.plugins.lineNumbers.getLine(u,n),a=Prism.plugins.lineNumbers.getLine(u,i);if(o){var l=o.offsetTop+"px";m.push(function(){r.style.top=l})}if(a){var s=a.offsetTop-o.offsetTop+a.offsetHeight+"px";m.push(function(){r.style.height=s})}}else m.push(function(){r.setAttribute("data-start",n),n<i&&r.setAttribute("data-end",i),r.style.top=(n-c-1)*f+"px",r.textContent=new Array(i-n+2).join(" \n")});m.push(function(){p.appendChild(r)})}),function(){m.forEach(i)}}function u(){var e=location.hash.slice(1);r(".temporary.line-highlight").forEach(function(e){e.parentNode.removeChild(e)});var t=(e.match(/\.([\d,-]+)$/)||[,""])[1];if(t&&!document.getElementById(e)){var n=e.slice(0,e.lastIndexOf(".")),i=document.getElementById(n);if(i)i.hasAttribute("data-line")||i.setAttribute("data-line",""),s(i,t,"temporary ")(),document.querySelector(".temporary.line-highlight").scrollIntoView()}}}();
!function(){if("undefined"!=typeof self&&self.Prism&&self.document){var l="line-numbers",c=/\n(?!$)/g,m=function(e){var t=a(e)["white-space"];if("pre-wrap"===t||"pre-line"===t){var n=e.querySelector("code"),r=e.querySelector(".line-numbers-rows"),s=e.querySelector(".line-numbers-sizer"),i=n.textContent.split(c);s||((s=document.createElement("span")).className="line-numbers-sizer",n.appendChild(s)),s.style.display="block",i.forEach(function(e,t){s.textContent=e||"\n";var n=s.getBoundingClientRect().height;r.children[t].style.height=n+"px"}),s.textContent="",s.style.display="none"}},a=function(e){return e?window.getComputedStyle?getComputedStyle(e):e.currentStyle||null:null};window.addEventListener("resize",function(){Array.prototype.forEach.call(document.querySelectorAll("pre."+l),m)}),Prism.hooks.add("complete",function(e){if(e.code){var t=e.element,n=t.parentNode;if(n&&/pre/i.test(n.nodeName)&&!t.querySelector(".line-numbers-rows")){for(var r=!1,s=/(?:^|\s)line-numbers(?:\s|$)/,i=t;i;i=i.parentNode)if(s.test(i.className)){r=!0;break}if(r){t.className=t.className.replace(s," "),s.test(n.className)||(n.className+=" line-numbers");var l,a=e.code.match(c),o=a?a.length+1:1,u=new Array(o+1).join("<span></span>");(l=document.createElement("span")).setAttribute("aria-hidden","true"),l.className="line-numbers-rows",l.innerHTML=u,n.hasAttribute("data-start")&&(n.style.counterReset="linenumber "+(parseInt(n.getAttribute("data-start"),10)-1)),e.element.appendChild(l),m(n),Prism.hooks.run("line-numbers",e)}}}}),Prism.hooks.add("line-numbers",function(e){e.plugins=e.plugins||{},e.plugins.lineNumbers=!0}),Prism.plugins.lineNumbers={getLine:function(e,t){if("PRE"===e.tagName&&e.classList.contains(l)){var n=e.querySelector(".line-numbers-rows"),r=parseInt(e.getAttribute("data-start"),10)||1,s=r+(n.children.length-1);t<r&&(t=r),s<t&&(t=s);var i=t-r;return n.children[i]}}}}}();
!function(){if(("undefined"==typeof self||self.Prism)&&("undefined"==typeof global||global.Prism)){var t=/\b([a-z]{3,7}:\/\/|tel:)[\w\-+%~/.:=&@]+(?:\?[\w\-+%~/.:=?&!$'()*,;@]*)?(?:#[\w\-+%~/.:#=?&!$'()*,;@]*)?/,r=/\b\S+@[\w.]+[a-z]{2}/,a=/\[([^\]]+)]\(([^)]+)\)/,l=["comment","url","attr-value","string"];Prism.plugins.autolinker={processGrammar:function(i){i&&!i["url-link"]&&(Prism.languages.DFS(i,function(i,n,e){-1<l.indexOf(e)&&!Array.isArray(n)&&(n.pattern||(n=this[i]={pattern:n}),n.inside=n.inside||{},"comment"==e&&(n.inside["md-link"]=a),"attr-value"==e?Prism.languages.insertBefore("inside","punctuation",{"url-link":t},n):n.inside["url-link"]=t,n.inside["email-link"]=r)}),i["url-link"]=t,i["email-link"]=r)}},Prism.hooks.add("before-highlight",function(i){Prism.plugins.autolinker.processGrammar(i.grammar)}),Prism.hooks.add("wrap",function(i){if(/-link$/.test(i.type)){i.tag="a";var n=i.content;if("email-link"==i.type&&0!=n.indexOf("mailto:"))n="mailto:"+n;else if("md-link"==i.type){var e=i.content.match(a);n=e[2],i.content=e[1]}i.attributes.href=n;try{i.content=decodeURIComponent(i.content)}catch(i){}}})}}();
!function(){if("undefined"!=typeof self&&self.Prism&&self.document){var u=/(?:^|\s)command-line(?:\s|$)/;Prism.hooks.add("before-highlight",function(e){var t=e.vars=e.vars||{},a=t["command-line"]=t["command-line"]||{};if(!a.complete&&e.code){var n=e.element.parentNode;if(n&&/pre/i.test(n.nodeName)&&(u.test(n.className)||u.test(e.element.className)))if(e.element.querySelector(".command-line-prompt"))a.complete=!0;else{var r=e.code.split("\n");a.numberOfLines=r.length;var s=a.outputLines=[],o=n.getAttribute("data-output"),i=n.getAttribute("data-filter-output");if(o||""===o){o=o.split(",");for(var l=0;l<o.length;l++){var m=o[l].split("-"),p=parseInt(m[0],10),d=2===m.length?parseInt(m[1],10):p;if(!isNaN(p)&&!isNaN(d)){p<1&&(p=1),d>r.length&&(d=r.length),d--;for(var c=--p;c<=d;c++)s[c]=r[c],r[c]=""}}}else if(i)for(l=0;l<r.length;l++)0===r[l].indexOf(i)&&(s[l]=r[l].slice(i.length),r[l]="");e.code=r.join("\n")}else a.complete=!0}else a.complete=!0}),Prism.hooks.add("before-insert",function(e){var t=e.vars=e.vars||{},a=t["command-line"]=t["command-line"]||{};if(!a.complete){for(var n=e.highlightedCode.split("\n"),r=0,s=(a.outputLines||[]).length;r<s;r++)a.outputLines.hasOwnProperty(r)&&(n[r]=a.outputLines[r]);e.highlightedCode=n.join("\n")}}),Prism.hooks.add("complete",function(e){var t=e.vars=e.vars||{},a=t["command-line"]=t["command-line"]||{};if(!a.complete){var n=e.element.parentNode;u.test(e.element.className)&&(e.element.className=e.element.className.replace(u," ")),u.test(n.className)||(n.className+=" command-line");var r=function(e,t){return(n.getAttribute(e)||t).replace(/"/g,"&quot")},s=new Array((a.numberOfLines||0)+1),o=r("data-prompt","");if(""!==o)s=s.join('<span data-prompt="'+o+'"></span>');else{var i=r("data-user","user"),l=r("data-host","localhost");s=s.join('<span data-user="'+i+'" data-host="'+l+'"></span>')}var m=document.createElement("span");m.className="command-line-prompt",m.innerHTML=s;for(var p=0,d=(a.outputLines||[]).length;p<d;p++)if(a.outputLines.hasOwnProperty(p)){var c=m.children[p];c.removeAttribute("data-user"),c.removeAttribute("data-host"),c.removeAttribute("data-prompt")}e.element.insertBefore(m,e.element.firstChild),a.complete=!0}})}}();
!function(){if("undefined"!=typeof self&&self.Prism&&self.document){var c=/(?:^|\s)match-braces(?:\s|$)/,a=/(?:^|\s)brace-hover(?:\s|$)/,l=/(?:^|\s)brace-selected(?:\s|$)/,n=/(?:^|\s)no-brace-hover(?:\s|$)/,t=/(?:^|\s)no-brace-select(?:\s|$)/,u={"(":")","[":"]","{":"}"},f={"(":"brace-round","[":"brace-square","{":"brace-curly"},m=0,r=/^(pair-\d+-)(open|close)$/;Prism.hooks.add("complete",function(e){var a=e.element,n=a.parentElement;if(n&&"PRE"==n.tagName){for(var t=[],r=a;r;r=r.parentElement)if(c.test(r.className)){t.push("(","[","{");break}if(0!=t.length){n.__listenerAdded||(n.addEventListener("mousedown",function(){var e=n.querySelector("code");Array.prototype.slice.call(e.querySelectorAll(".brace-selected")).forEach(function(e){e.className=e.className.replace(l," ")})}),Object.defineProperty(n,"__listenerAdded",{value:!0}));var o=Array.prototype.slice.call(a.querySelectorAll("span.token.punctuation")),i=[];t.forEach(function(e){for(var a=u[e],n=f[e],t=[],r=[],s=0;s<o.length;s++){var c=o[s];if(0==c.childElementCount){var l=c.textContent;l===e?(i.push({index:s,open:!0,element:c}),c.className+=" "+n,c.className+=" brace-open",r.push(s)):l===a&&(i.push({index:s,open:!1,element:c}),c.className+=" "+n,c.className+=" brace-close",r.length&&t.push([s,r.pop()]))}}t.forEach(function(e){var a="pair-"+m+++"-",n=o[e[0]],t=o[e[1]];n.id=a+"open",t.id=a+"close",[n,t].forEach(function(e){e.addEventListener("mouseenter",p),e.addEventListener("mouseleave",d),e.addEventListener("click",h)})})});var s=0;i.sort(function(e,a){return e.index-a.index}),i.forEach(function(e){e.open?(e.element.className+=" brace-level-"+(s%12+1),s++):(s=Math.max(0,s-1),e.element.className+=" brace-level-"+(s%12+1))})}}})}function s(e){var a=r.exec(e.id);return document.querySelector("#"+a[1]+("open"==a[2]?"close":"open"))}function p(){for(var e=this.parentElement;e;e=e.parentElement)if(n.test(e.className))return;[this,s(this)].forEach(function(e){e.className=(e.className.replace(a," ")+" brace-hover").replace(/\s+/g," ")})}function d(){[this,s(this)].forEach(function(e){e.className=e.className.replace(a," ")})}function h(){for(var e=this.parentElement;e;e=e.parentElement)if(t.test(e.className))return;[this,s(this)].forEach(function(e){e.className=(e.className.replace(l," ")+" brace-selected").replace(/\s+/g," ")})}}();

    </script>
    <script type="text/javascript">
      
      window.$__offline__$ = true;
      
      // neptune.js
      (function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
/* global Prism */

// bind input to the textarea to the code tag
const codeInputHandler = function (codeTag, textAreaTag) {
  textAreaTag.scrollTop = 0;
  let code = textAreaTag.value;

  codeTag.innerHTML = code + ' ';
  Prism.highlightElement(codeTag);
};

// creates a transparent textarea that serves as an 'editor' for the code in
// the associated <code> tag
module.exports = function (codeTag) {
  codeTag.innerHTML += ' ';

  const element = document.createElement('textarea');
  element.classList.add('code-editor');
  element.setAttribute('spellcheck', 'false');

  // expose handler for input binding
  element.handler = codeInputHandler.bind(null, codeTag, element);

  // listen to any input changes
  if (element.addEventListener) {
    element.addEventListener('input', element.handler);
  } else if (element.attachEvent) { // for IE11
    element.attachEvent('onpropertychange', element.handler);
  }

  // put code in textarea
  element.value = codeTag.textContent;

  return element;
};

},{}],2:[function(require,module,exports){
// Store all scopes
const scopes = {};

// creates the function without a closure (in global scope)
// protects the scope of this file and other neptune files from interferance from inside eval
const $__eval__$ = new Function(
  'return eval("' +
    // Quine for scoping evals
    // Simplified fiddle to help understand why this quine is useful: https://jsfiddle.net/kjvo6h2x/
    'var $__eval__$;' +
    '$__eval__$ = function $__eval__$($__code__$) {' +
      'eval($__code__$);' +
      'eval($__eval__$.toString());' +
      'return $__eval__$;' +
    '};' + // function is returned by this statement
  '");'
)();

const logMiddlewareBrowser = function (tabID) {
  return 'var Console = document.getElementById(\''+tabID+'-output\').Console;';
}

const logMiddlewareServer = 'var Console = {};' +
  'Console.log = function () {' +
    'global.$__logs__$.push(arguments);' +
  '};';

// determine scope and eval within it!
module.exports = function (code, scopeName, tabID) {
  code = tabID ? logMiddlewareBrowser(tabID) : logMiddlewareServer + code;

  if (scopeName == null) {
    scopeName = '$__DEFAULT__$';
  }

  // create empty scope if it does not exist
  if (scopes[scopeName] == null) {
    scopes[scopeName] = $__eval__$;
  }

  // eval within scope
  scopes[scopeName] = scopes[scopeName](code);
};

},{}],3:[function(require,module,exports){
(function () {
  const Tabs = require('./tabs.js');

  /*
   * Detect <pre> and <code> tags of interest
   */
  const preTags = Array.from(document.getElementsByTagName('pre'));
  const codeTags = preTags.map(function (preTag) {
    return Array.from(preTag.getElementsByTagName('code'));
  }).reduce(function (codeTags1, codeTags2) {
    return codeTags1.concat(codeTags2);
  }, []).filter(function (codeTag) {
    return codeTag.className.indexOf('language-neptune') > -1;
  });

  /*
   * Helper functions
   */
  const getOptions = function (codeTag) {
    const defaultOptions = {
      title: 'Javascript',
      env: 'browser'
    };

    // result
    const options = Object.assign({}, defaultOptions);
    const addOption = function (key, val) {
      options[key] = val;

      if (key === 'env' && options['title'] === defaultOptions['title']) {
        options['title'] = val;
      }
    };

    // parse options
    for (let className of codeTag.classList) {
      className = className.trim();
      if (!className.startsWith('neptune') || className.indexOf('[') === -1) {
        continue;
      }

      className = className.substring(('neptune[').length, className.length-1);
      className.split(',').map(function (option) {
        const index = option.indexOf('=');
        const key = option.substring(0, index);
        const val = option.substring(index + 1);
        addOption(key, val);
      });
    }

    return options;
  };

  const styleCodeBlock = function (codeTag) {
    const preTag = codeTag.parentNode;

    // get neptune code options from markdown
    const options = getOptions(codeTag);
    codeTag.dataset.options = JSON.stringify(options);

    // Make sure PRISM understands that this is JS
    codeTag.className = 'language-javascript';
    preTag.className = 'language-javascript';
    preTag.classList.add('line-numbers'); // add line numbering

    // Style code as a tabbed frame with a toolbar and editor!
    Tabs(preTag, codeTag);
  };

  /*
   * Apply styling and functionality
   */
  codeTags.map(function (codeTag) {
    styleCodeBlock(codeTag);
  });
})();

},{"./tabs.js":6}],4:[function(require,module,exports){
/* global Prism */

function reset() {
  this.style.display = 'block';
  this.children[0].innerHTML = 'Running...';
}

function display(output) {
  if (this.children[0].textContent === 'Running...') {
    this.children[0].innerHTML = '';
  } else {
    this.children[0].innerHTML += '\n';
  }

  this.children[0].innerHTML += output;
  Prism.highlightElement(this.children[0]);
}

// mimic console.log / console.time / etc
const Console = {
  // this here is bound to the output panel HTML element
  log: function () {
    var msg = '';
    for (var i = 0; i < arguments.length; i++) {
      if (typeof(arguments[i]) === 'object') {
        msg += JSON.stringify(arguments[i]) + ' ';
      } else {
        msg += arguments[i] + ' ';
      }
    }
    this.display(msg);
  }
};

// creates a transparent textarea that serves as an 'editor' for the code in
// the associated <code> tag
module.exports = function (tabID, options) {
  // create pre tag
  const preElement = document.createElement('pre');
  preElement.id = tabID + '-output';
  preElement.classList.add('command-line');
  preElement.classList.add('output-panel');

  preElement.dataset.user = options['title'].toLowerCase();
  preElement.dataset.host = options['env'].toLowerCase();  
  
  // create code tag
  const codeElement = document.createElement('code');
  codeElement.className = 'language-bash';
  preElement.appendChild(codeElement);

  // bind logging functions to output panel HTML element
  preElement.reset = reset.bind(preElement);
  preElement.display = display.bind(preElement);
  preElement.Console = {};
  for (const attr in Console) {
    preElement.Console[attr] = Console[attr].bind(preElement);
  }
  
  return preElement;
};

},{}],5:[function(require,module,exports){
// Execute this code using in the given scope name in the server via node, and get back results!
module.exports = function (code, scopeName, tabID) {
  if (window.$__offline__$) {
    alert('Cannot execute server-side code while offline!');
    return;
  }

  const xhr = new XMLHttpRequest();
  xhr.open('POST', window.location.href + '/__exec');
  xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
  xhr.onreadystatechange = function (e) {
    if (xhr.readyState === 4 && xhr.status === 200) {
      const outputPanel = document.getElementById(tabID + '-output');
      for (const record of JSON.parse(xhr.responseText)) {
        outputPanel.Console.log.apply(outputPanel, record);
      }
    }
  };
  xhr.send(JSON.stringify({scopeName: scopeName, code: code}));
};

},{}],6:[function(require,module,exports){
/*
 * dependencies
 */
const Toolbar = require('./toolbar.js');
const Editor = require('./editor.js');
const OutputPanel = require('./outputPanel.js');

let autoCounter = 0;

const createTab = function (title, tabsContainer, preTag, options) {
  const tabRadio = document.createElement('input');
  const tabLabel = document.createElement('label');
  const codeTab = document.createElement('div');

  // create ID for radio
  const count = tabsContainer.getElementsByTagName('input').length;
  const tabID = tabsContainer.id + '-tab-' + (count + 1);

  // style lable and radio
  tabRadio.className = 'tab-input';
  tabRadio.id = tabID;
  tabRadio.name = tabsContainer.id;
  tabRadio.type = 'radio';

  tabLabel.className = 'tab-label';
  tabLabel.id = tabID + '-label';
  tabLabel.setAttribute('for', tabID);
  tabLabel.innerHTML = title;
  if (count === 0) {
    tabRadio.setAttribute('checked', 'checked');
    tabLabel.classList.add('tab-label-selected');
    tabsContainer.dataset.selected = tabID;
  }

  tabRadio.onclick = function (e) {
    // remove selection from previous label
    const lastVal = tabsContainer.dataset.selected;
    const prevLabel = document.getElementById(lastVal + '-label');
    prevLabel.classList.remove('tab-label-selected');
    // select this label
    tabsContainer.dataset.selected = tabID;
    tabLabel.classList.add('tab-label-selected');
  };

  // style container
  codeTab.classList.add('code-tab');

  // add toolbar and <pre> tag and output area
  codeTab.appendChild(Toolbar(tabID));
  codeTab.appendChild(preTag);
  codeTab.appendChild(OutputPanel(tabID, options));

  // add the code container to the tabs
  tabsContainer.insertBefore(tabLabel, tabsContainer.children[count]);
  tabsContainer.appendChild(tabRadio);
  tabsContainer.appendChild(codeTab);
};

const createTabsContainer = function (frameID) {
  const container = document.createElement('div');
  container.id = frameID;
  container.classList.add('code-tabs');
  return container;
};

const getOrCreateTabsContainer = function (frameID, preTag) {
  frameID = frameID || 'neptune-frame-' + (autoCounter++);
  let container = document.getElementById(frameID);

  if (container == null) {
    container = createTabsContainer(frameID);
    preTag.parentNode.replaceChild(container, preTag);
  } else {
    preTag.parentNode.removeChild(preTag);
  }

  return container;
};

module.exports = function (preTag, codeTag) {
  // Parse options from markdown
  const options = JSON.parse(codeTag.dataset.options);
  const frameID = options['frame'];
  const title = options['title'];

  // Create (or get if exists) the tabs frame container
  const tabsContainer = getOrCreateTabsContainer(frameID, preTag);

  // Add this <pre><code> tags as a tab to the container
  createTab(title, tabsContainer, preTag, options);

  // add transparent text area that mimics the code tag
  preTag.appendChild(Editor(codeTag));
};

},{"./editor.js":1,"./outputPanel.js":4,"./toolbar.js":7}],7:[function(require,module,exports){
const scopedEval = require('./eval.js');
const serverExec = require('./serverExec.js');

// handles clicking on an icon in the code toolbar
const toolbarClick = function () {
  const tabID = this.parentNode.dataset.tabID;
  const type = this.children[0].classList[1].split('-')[1];
  const codeTag = this.parentNode.parentNode.getElementsByTagName('code')[0];
  const textAreaTag = this.parentNode.parentNode.getElementsByTagName('textarea')[0];
  const options = JSON.parse(codeTag.dataset.options);
  const outputPanel = document.getElementById(tabID + '-output');

  let range;
  switch (type) {
    case 'copy':
      window.getSelection().removeAllRanges();
      range = document.createRange();
      range.selectNode(codeTag);
      window.getSelection().addRange(range);
      document.execCommand('copy');
      window.getSelection().removeAllRanges();
      break;

    case 'trash':
      textAreaTag.value = '';
      textAreaTag.handler();
      break;

    case 'play':
      outputPanel.reset();
      if (options['env'] === 'server') {
        serverExec(codeTag.textContent, options['scope'], tabID);
      } else {
        scopedEval(codeTag.textContent, options['scope'], tabID);
      }
      break;
  }
};

// creates HTML elements for the toolbar on top of <code> tags
module.exports = function (tabID, handler=toolbarClick) {
  const element = document.createElement('div');
  element.classList.add('code-toolbar');
  element.dataset.tabID = tabID;
  element.innerHTML = '<a href="javascript:void(0)"><i class="fa fa-play"></i></a>' +
    '<a href="javascript:void(0)"><i class="fa fa-copy"></i></a>' +
    '<a href="javascript:void(0)"><i class="fa fa-trash"></i></a>';

  Array.from(element.children).map(function (aTag) {
    aTag.onclick = handler;
  });

  return element;
};

},{"./eval.js":2,"./serverExec.js":5}]},{},[3])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3Vzci9sb2NhbC9saWIvbm9kZV9tb2R1bGVzL2Jyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXItcGFjay9fcHJlbHVkZS5qcyIsInNyYy9zdGF0aWNzL2Jyb3dzZXJpZnkvZWRpdG9yLmpzIiwic3JjL3N0YXRpY3MvYnJvd3NlcmlmeS9ldmFsLmpzIiwic3JjL3N0YXRpY3MvYnJvd3NlcmlmeS9uZXB0dW5lLmpzIiwic3JjL3N0YXRpY3MvYnJvd3NlcmlmeS9vdXRwdXRQYW5lbC5qcyIsInNyYy9zdGF0aWNzL2Jyb3dzZXJpZnkvc2VydmVyRXhlYy5qcyIsInNyYy9zdGF0aWNzL2Jyb3dzZXJpZnkvdGFicy5qcyIsInNyYy9zdGF0aWNzL2Jyb3dzZXJpZnkvdG9vbGJhci5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQ0FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNuQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMzQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM1RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM3REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3BCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzlGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCl7ZnVuY3Rpb24gcihlLG4sdCl7ZnVuY3Rpb24gbyhpLGYpe2lmKCFuW2ldKXtpZighZVtpXSl7dmFyIGM9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZTtpZighZiYmYylyZXR1cm4gYyhpLCEwKTtpZih1KXJldHVybiB1KGksITApO3ZhciBhPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIraStcIidcIik7dGhyb3cgYS5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGF9dmFyIHA9bltpXT17ZXhwb3J0czp7fX07ZVtpXVswXS5jYWxsKHAuZXhwb3J0cyxmdW5jdGlvbihyKXt2YXIgbj1lW2ldWzFdW3JdO3JldHVybiBvKG58fHIpfSxwLHAuZXhwb3J0cyxyLGUsbix0KX1yZXR1cm4gbltpXS5leHBvcnRzfWZvcih2YXIgdT1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlLGk9MDtpPHQubGVuZ3RoO2krKylvKHRbaV0pO3JldHVybiBvfXJldHVybiByfSkoKSIsIi8qIGdsb2JhbCBQcmlzbSAqL1xuXG4vLyBiaW5kIGlucHV0IHRvIHRoZSB0ZXh0YXJlYSB0byB0aGUgY29kZSB0YWdcbmNvbnN0IGNvZGVJbnB1dEhhbmRsZXIgPSBmdW5jdGlvbiAoY29kZVRhZywgdGV4dEFyZWFUYWcpIHtcbiAgdGV4dEFyZWFUYWcuc2Nyb2xsVG9wID0gMDtcbiAgbGV0IGNvZGUgPSB0ZXh0QXJlYVRhZy52YWx1ZTtcblxuICBjb2RlVGFnLmlubmVySFRNTCA9IGNvZGUgKyAnICc7XG4gIFByaXNtLmhpZ2hsaWdodEVsZW1lbnQoY29kZVRhZyk7XG59O1xuXG4vLyBjcmVhdGVzIGEgdHJhbnNwYXJlbnQgdGV4dGFyZWEgdGhhdCBzZXJ2ZXMgYXMgYW4gJ2VkaXRvcicgZm9yIHRoZSBjb2RlIGluXG4vLyB0aGUgYXNzb2NpYXRlZCA8Y29kZT4gdGFnXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChjb2RlVGFnKSB7XG4gIGNvZGVUYWcuaW5uZXJIVE1MICs9ICcgJztcblxuICBjb25zdCBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGV4dGFyZWEnKTtcbiAgZWxlbWVudC5jbGFzc0xpc3QuYWRkKCdjb2RlLWVkaXRvcicpO1xuICBlbGVtZW50LnNldEF0dHJpYnV0ZSgnc3BlbGxjaGVjaycsICdmYWxzZScpO1xuXG4gIC8vIGV4cG9zZSBoYW5kbGVyIGZvciBpbnB1dCBiaW5kaW5nXG4gIGVsZW1lbnQuaGFuZGxlciA9IGNvZGVJbnB1dEhhbmRsZXIuYmluZChudWxsLCBjb2RlVGFnLCBlbGVtZW50KTtcblxuICAvLyBsaXN0ZW4gdG8gYW55IGlucHV0IGNoYW5nZXNcbiAgaWYgKGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcikge1xuICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCBlbGVtZW50LmhhbmRsZXIpO1xuICB9IGVsc2UgaWYgKGVsZW1lbnQuYXR0YWNoRXZlbnQpIHsgLy8gZm9yIElFMTFcbiAgICBlbGVtZW50LmF0dGFjaEV2ZW50KCdvbnByb3BlcnR5Y2hhbmdlJywgZWxlbWVudC5oYW5kbGVyKTtcbiAgfVxuXG4gIC8vIHB1dCBjb2RlIGluIHRleHRhcmVhXG4gIGVsZW1lbnQudmFsdWUgPSBjb2RlVGFnLnRleHRDb250ZW50O1xuXG4gIHJldHVybiBlbGVtZW50O1xufTtcbiIsIi8vIFN0b3JlIGFsbCBzY29wZXNcbmNvbnN0IHNjb3BlcyA9IHt9O1xuXG4vLyBjcmVhdGVzIHRoZSBmdW5jdGlvbiB3aXRob3V0IGEgY2xvc3VyZSAoaW4gZ2xvYmFsIHNjb3BlKVxuLy8gcHJvdGVjdHMgdGhlIHNjb3BlIG9mIHRoaXMgZmlsZSBhbmQgb3RoZXIgbmVwdHVuZSBmaWxlcyBmcm9tIGludGVyZmVyYW5jZSBmcm9tIGluc2lkZSBldmFsXG5jb25zdCAkX19ldmFsX18kID0gbmV3IEZ1bmN0aW9uKFxuICAncmV0dXJuIGV2YWwoXCInICtcbiAgICAvLyBRdWluZSBmb3Igc2NvcGluZyBldmFsc1xuICAgIC8vIFNpbXBsaWZpZWQgZmlkZGxlIHRvIGhlbHAgdW5kZXJzdGFuZCB3aHkgdGhpcyBxdWluZSBpcyB1c2VmdWw6IGh0dHBzOi8vanNmaWRkbGUubmV0L2tqdm82aDJ4L1xuICAgICd2YXIgJF9fZXZhbF9fJDsnICtcbiAgICAnJF9fZXZhbF9fJCA9IGZ1bmN0aW9uICRfX2V2YWxfXyQoJF9fY29kZV9fJCkgeycgK1xuICAgICAgJ2V2YWwoJF9fY29kZV9fJCk7JyArXG4gICAgICAnZXZhbCgkX19ldmFsX18kLnRvU3RyaW5nKCkpOycgK1xuICAgICAgJ3JldHVybiAkX19ldmFsX18kOycgK1xuICAgICd9OycgKyAvLyBmdW5jdGlvbiBpcyByZXR1cm5lZCBieSB0aGlzIHN0YXRlbWVudFxuICAnXCIpOydcbikoKTtcblxuY29uc3QgbG9nTWlkZGxld2FyZUJyb3dzZXIgPSBmdW5jdGlvbiAodGFiSUQpIHtcbiAgcmV0dXJuICd2YXIgQ29uc29sZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFxcJycrdGFiSUQrJy1vdXRwdXRcXCcpLkNvbnNvbGU7Jztcbn1cblxuY29uc3QgbG9nTWlkZGxld2FyZVNlcnZlciA9ICd2YXIgQ29uc29sZSA9IHt9OycgK1xuICAnQ29uc29sZS5sb2cgPSBmdW5jdGlvbiAoKSB7JyArXG4gICAgJ2dsb2JhbC4kX19sb2dzX18kLnB1c2goYXJndW1lbnRzKTsnICtcbiAgJ307JztcblxuLy8gZGV0ZXJtaW5lIHNjb3BlIGFuZCBldmFsIHdpdGhpbiBpdCFcbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGNvZGUsIHNjb3BlTmFtZSwgdGFiSUQpIHtcbiAgY29kZSA9IHRhYklEID8gbG9nTWlkZGxld2FyZUJyb3dzZXIodGFiSUQpIDogbG9nTWlkZGxld2FyZVNlcnZlciArIGNvZGU7XG5cbiAgaWYgKHNjb3BlTmFtZSA9PSBudWxsKSB7XG4gICAgc2NvcGVOYW1lID0gJyRfX0RFRkFVTFRfXyQnO1xuICB9XG5cbiAgLy8gY3JlYXRlIGVtcHR5IHNjb3BlIGlmIGl0IGRvZXMgbm90IGV4aXN0XG4gIGlmIChzY29wZXNbc2NvcGVOYW1lXSA9PSBudWxsKSB7XG4gICAgc2NvcGVzW3Njb3BlTmFtZV0gPSAkX19ldmFsX18kO1xuICB9XG5cbiAgLy8gZXZhbCB3aXRoaW4gc2NvcGVcbiAgc2NvcGVzW3Njb3BlTmFtZV0gPSBzY29wZXNbc2NvcGVOYW1lXShjb2RlKTtcbn07XG4iLCIoZnVuY3Rpb24gKCkge1xuICBjb25zdCBUYWJzID0gcmVxdWlyZSgnLi90YWJzLmpzJyk7XG5cbiAgLypcbiAgICogRGV0ZWN0IDxwcmU+IGFuZCA8Y29kZT4gdGFncyBvZiBpbnRlcmVzdFxuICAgKi9cbiAgY29uc3QgcHJlVGFncyA9IEFycmF5LmZyb20oZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3ByZScpKTtcbiAgY29uc3QgY29kZVRhZ3MgPSBwcmVUYWdzLm1hcChmdW5jdGlvbiAocHJlVGFnKSB7XG4gICAgcmV0dXJuIEFycmF5LmZyb20ocHJlVGFnLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdjb2RlJykpO1xuICB9KS5yZWR1Y2UoZnVuY3Rpb24gKGNvZGVUYWdzMSwgY29kZVRhZ3MyKSB7XG4gICAgcmV0dXJuIGNvZGVUYWdzMS5jb25jYXQoY29kZVRhZ3MyKTtcbiAgfSwgW10pLmZpbHRlcihmdW5jdGlvbiAoY29kZVRhZykge1xuICAgIHJldHVybiBjb2RlVGFnLmNsYXNzTmFtZS5pbmRleE9mKCdsYW5ndWFnZS1uZXB0dW5lJykgPiAtMTtcbiAgfSk7XG5cbiAgLypcbiAgICogSGVscGVyIGZ1bmN0aW9uc1xuICAgKi9cbiAgY29uc3QgZ2V0T3B0aW9ucyA9IGZ1bmN0aW9uIChjb2RlVGFnKSB7XG4gICAgY29uc3QgZGVmYXVsdE9wdGlvbnMgPSB7XG4gICAgICB0aXRsZTogJ0phdmFzY3JpcHQnLFxuICAgICAgZW52OiAnYnJvd3NlcidcbiAgICB9O1xuXG4gICAgLy8gcmVzdWx0XG4gICAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oe30sIGRlZmF1bHRPcHRpb25zKTtcbiAgICBjb25zdCBhZGRPcHRpb24gPSBmdW5jdGlvbiAoa2V5LCB2YWwpIHtcbiAgICAgIG9wdGlvbnNba2V5XSA9IHZhbDtcblxuICAgICAgaWYgKGtleSA9PT0gJ2VudicgJiYgb3B0aW9uc1sndGl0bGUnXSA9PT0gZGVmYXVsdE9wdGlvbnNbJ3RpdGxlJ10pIHtcbiAgICAgICAgb3B0aW9uc1sndGl0bGUnXSA9IHZhbDtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgLy8gcGFyc2Ugb3B0aW9uc1xuICAgIGZvciAobGV0IGNsYXNzTmFtZSBvZiBjb2RlVGFnLmNsYXNzTGlzdCkge1xuICAgICAgY2xhc3NOYW1lID0gY2xhc3NOYW1lLnRyaW0oKTtcbiAgICAgIGlmICghY2xhc3NOYW1lLnN0YXJ0c1dpdGgoJ25lcHR1bmUnKSB8fCBjbGFzc05hbWUuaW5kZXhPZignWycpID09PSAtMSkge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cblxuICAgICAgY2xhc3NOYW1lID0gY2xhc3NOYW1lLnN1YnN0cmluZygoJ25lcHR1bmVbJykubGVuZ3RoLCBjbGFzc05hbWUubGVuZ3RoLTEpO1xuICAgICAgY2xhc3NOYW1lLnNwbGl0KCcsJykubWFwKGZ1bmN0aW9uIChvcHRpb24pIHtcbiAgICAgICAgY29uc3QgaW5kZXggPSBvcHRpb24uaW5kZXhPZignPScpO1xuICAgICAgICBjb25zdCBrZXkgPSBvcHRpb24uc3Vic3RyaW5nKDAsIGluZGV4KTtcbiAgICAgICAgY29uc3QgdmFsID0gb3B0aW9uLnN1YnN0cmluZyhpbmRleCArIDEpO1xuICAgICAgICBhZGRPcHRpb24oa2V5LCB2YWwpO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIG9wdGlvbnM7XG4gIH07XG5cbiAgY29uc3Qgc3R5bGVDb2RlQmxvY2sgPSBmdW5jdGlvbiAoY29kZVRhZykge1xuICAgIGNvbnN0IHByZVRhZyA9IGNvZGVUYWcucGFyZW50Tm9kZTtcblxuICAgIC8vIGdldCBuZXB0dW5lIGNvZGUgb3B0aW9ucyBmcm9tIG1hcmtkb3duXG4gICAgY29uc3Qgb3B0aW9ucyA9IGdldE9wdGlvbnMoY29kZVRhZyk7XG4gICAgY29kZVRhZy5kYXRhc2V0Lm9wdGlvbnMgPSBKU09OLnN0cmluZ2lmeShvcHRpb25zKTtcblxuICAgIC8vIE1ha2Ugc3VyZSBQUklTTSB1bmRlcnN0YW5kcyB0aGF0IHRoaXMgaXMgSlNcbiAgICBjb2RlVGFnLmNsYXNzTmFtZSA9ICdsYW5ndWFnZS1qYXZhc2NyaXB0JztcbiAgICBwcmVUYWcuY2xhc3NOYW1lID0gJ2xhbmd1YWdlLWphdmFzY3JpcHQnO1xuICAgIHByZVRhZy5jbGFzc0xpc3QuYWRkKCdsaW5lLW51bWJlcnMnKTsgLy8gYWRkIGxpbmUgbnVtYmVyaW5nXG5cbiAgICAvLyBTdHlsZSBjb2RlIGFzIGEgdGFiYmVkIGZyYW1lIHdpdGggYSB0b29sYmFyIGFuZCBlZGl0b3IhXG4gICAgVGFicyhwcmVUYWcsIGNvZGVUYWcpO1xuICB9O1xuXG4gIC8qXG4gICAqIEFwcGx5IHN0eWxpbmcgYW5kIGZ1bmN0aW9uYWxpdHlcbiAgICovXG4gIGNvZGVUYWdzLm1hcChmdW5jdGlvbiAoY29kZVRhZykge1xuICAgIHN0eWxlQ29kZUJsb2NrKGNvZGVUYWcpO1xuICB9KTtcbn0pKCk7XG4iLCIvKiBnbG9iYWwgUHJpc20gKi9cblxuZnVuY3Rpb24gcmVzZXQoKSB7XG4gIHRoaXMuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XG4gIHRoaXMuY2hpbGRyZW5bMF0uaW5uZXJIVE1MID0gJ1J1bm5pbmcuLi4nO1xufVxuXG5mdW5jdGlvbiBkaXNwbGF5KG91dHB1dCkge1xuICBpZiAodGhpcy5jaGlsZHJlblswXS50ZXh0Q29udGVudCA9PT0gJ1J1bm5pbmcuLi4nKSB7XG4gICAgdGhpcy5jaGlsZHJlblswXS5pbm5lckhUTUwgPSAnJztcbiAgfSBlbHNlIHtcbiAgICB0aGlzLmNoaWxkcmVuWzBdLmlubmVySFRNTCArPSAnXFxuJztcbiAgfVxuXG4gIHRoaXMuY2hpbGRyZW5bMF0uaW5uZXJIVE1MICs9IG91dHB1dDtcbiAgUHJpc20uaGlnaGxpZ2h0RWxlbWVudCh0aGlzLmNoaWxkcmVuWzBdKTtcbn1cblxuLy8gbWltaWMgY29uc29sZS5sb2cgLyBjb25zb2xlLnRpbWUgLyBldGNcbmNvbnN0IENvbnNvbGUgPSB7XG4gIC8vIHRoaXMgaGVyZSBpcyBib3VuZCB0byB0aGUgb3V0cHV0IHBhbmVsIEhUTUwgZWxlbWVudFxuICBsb2c6IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgbXNnID0gJyc7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmICh0eXBlb2YoYXJndW1lbnRzW2ldKSA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgbXNnICs9IEpTT04uc3RyaW5naWZ5KGFyZ3VtZW50c1tpXSkgKyAnICc7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBtc2cgKz0gYXJndW1lbnRzW2ldICsgJyAnO1xuICAgICAgfVxuICAgIH1cbiAgICB0aGlzLmRpc3BsYXkobXNnKTtcbiAgfVxufTtcblxuLy8gY3JlYXRlcyBhIHRyYW5zcGFyZW50IHRleHRhcmVhIHRoYXQgc2VydmVzIGFzIGFuICdlZGl0b3InIGZvciB0aGUgY29kZSBpblxuLy8gdGhlIGFzc29jaWF0ZWQgPGNvZGU+IHRhZ1xubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAodGFiSUQsIG9wdGlvbnMpIHtcbiAgLy8gY3JlYXRlIHByZSB0YWdcbiAgY29uc3QgcHJlRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3ByZScpO1xuICBwcmVFbGVtZW50LmlkID0gdGFiSUQgKyAnLW91dHB1dCc7XG4gIHByZUVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnY29tbWFuZC1saW5lJyk7XG4gIHByZUVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnb3V0cHV0LXBhbmVsJyk7XG5cbiAgcHJlRWxlbWVudC5kYXRhc2V0LnVzZXIgPSBvcHRpb25zWyd0aXRsZSddLnRvTG93ZXJDYXNlKCk7XG4gIHByZUVsZW1lbnQuZGF0YXNldC5ob3N0ID0gb3B0aW9uc1snZW52J10udG9Mb3dlckNhc2UoKTsgIFxuICBcbiAgLy8gY3JlYXRlIGNvZGUgdGFnXG4gIGNvbnN0IGNvZGVFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY29kZScpO1xuICBjb2RlRWxlbWVudC5jbGFzc05hbWUgPSAnbGFuZ3VhZ2UtYmFzaCc7XG4gIHByZUVsZW1lbnQuYXBwZW5kQ2hpbGQoY29kZUVsZW1lbnQpO1xuXG4gIC8vIGJpbmQgbG9nZ2luZyBmdW5jdGlvbnMgdG8gb3V0cHV0IHBhbmVsIEhUTUwgZWxlbWVudFxuICBwcmVFbGVtZW50LnJlc2V0ID0gcmVzZXQuYmluZChwcmVFbGVtZW50KTtcbiAgcHJlRWxlbWVudC5kaXNwbGF5ID0gZGlzcGxheS5iaW5kKHByZUVsZW1lbnQpO1xuICBwcmVFbGVtZW50LkNvbnNvbGUgPSB7fTtcbiAgZm9yIChjb25zdCBhdHRyIGluIENvbnNvbGUpIHtcbiAgICBwcmVFbGVtZW50LkNvbnNvbGVbYXR0cl0gPSBDb25zb2xlW2F0dHJdLmJpbmQocHJlRWxlbWVudCk7XG4gIH1cbiAgXG4gIHJldHVybiBwcmVFbGVtZW50O1xufTtcbiIsIi8vIEV4ZWN1dGUgdGhpcyBjb2RlIHVzaW5nIGluIHRoZSBnaXZlbiBzY29wZSBuYW1lIGluIHRoZSBzZXJ2ZXIgdmlhIG5vZGUsIGFuZCBnZXQgYmFjayByZXN1bHRzIVxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoY29kZSwgc2NvcGVOYW1lLCB0YWJJRCkge1xuICBpZiAod2luZG93LiRfX29mZmxpbmVfXyQpIHtcbiAgICBhbGVydCgnQ2Fubm90IGV4ZWN1dGUgc2VydmVyLXNpZGUgY29kZSB3aGlsZSBvZmZsaW5lIScpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuICB4aHIub3BlbignUE9TVCcsIHdpbmRvdy5sb2NhdGlvbi5ocmVmICsgJy9fX2V4ZWMnKTtcbiAgeGhyLnNldFJlcXVlc3RIZWFkZXIoXCJDb250ZW50LVR5cGVcIiwgXCJhcHBsaWNhdGlvbi9qc29uO2NoYXJzZXQ9VVRGLThcIik7XG4gIHhoci5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbiAoZSkge1xuICAgIGlmICh4aHIucmVhZHlTdGF0ZSA9PT0gNCAmJiB4aHIuc3RhdHVzID09PSAyMDApIHtcbiAgICAgIGNvbnN0IG91dHB1dFBhbmVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGFiSUQgKyAnLW91dHB1dCcpO1xuICAgICAgZm9yIChjb25zdCByZWNvcmQgb2YgSlNPTi5wYXJzZSh4aHIucmVzcG9uc2VUZXh0KSkge1xuICAgICAgICBvdXRwdXRQYW5lbC5Db25zb2xlLmxvZy5hcHBseShvdXRwdXRQYW5lbCwgcmVjb3JkKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG4gIHhoci5zZW5kKEpTT04uc3RyaW5naWZ5KHtzY29wZU5hbWU6IHNjb3BlTmFtZSwgY29kZTogY29kZX0pKTtcbn07XG4iLCIvKlxuICogZGVwZW5kZW5jaWVzXG4gKi9cbmNvbnN0IFRvb2xiYXIgPSByZXF1aXJlKCcuL3Rvb2xiYXIuanMnKTtcbmNvbnN0IEVkaXRvciA9IHJlcXVpcmUoJy4vZWRpdG9yLmpzJyk7XG5jb25zdCBPdXRwdXRQYW5lbCA9IHJlcXVpcmUoJy4vb3V0cHV0UGFuZWwuanMnKTtcblxubGV0IGF1dG9Db3VudGVyID0gMDtcblxuY29uc3QgY3JlYXRlVGFiID0gZnVuY3Rpb24gKHRpdGxlLCB0YWJzQ29udGFpbmVyLCBwcmVUYWcsIG9wdGlvbnMpIHtcbiAgY29uc3QgdGFiUmFkaW8gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpO1xuICBjb25zdCB0YWJMYWJlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xhYmVsJyk7XG4gIGNvbnN0IGNvZGVUYWIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcblxuICAvLyBjcmVhdGUgSUQgZm9yIHJhZGlvXG4gIGNvbnN0IGNvdW50ID0gdGFic0NvbnRhaW5lci5nZXRFbGVtZW50c0J5VGFnTmFtZSgnaW5wdXQnKS5sZW5ndGg7XG4gIGNvbnN0IHRhYklEID0gdGFic0NvbnRhaW5lci5pZCArICctdGFiLScgKyAoY291bnQgKyAxKTtcblxuICAvLyBzdHlsZSBsYWJsZSBhbmQgcmFkaW9cbiAgdGFiUmFkaW8uY2xhc3NOYW1lID0gJ3RhYi1pbnB1dCc7XG4gIHRhYlJhZGlvLmlkID0gdGFiSUQ7XG4gIHRhYlJhZGlvLm5hbWUgPSB0YWJzQ29udGFpbmVyLmlkO1xuICB0YWJSYWRpby50eXBlID0gJ3JhZGlvJztcblxuICB0YWJMYWJlbC5jbGFzc05hbWUgPSAndGFiLWxhYmVsJztcbiAgdGFiTGFiZWwuaWQgPSB0YWJJRCArICctbGFiZWwnO1xuICB0YWJMYWJlbC5zZXRBdHRyaWJ1dGUoJ2ZvcicsIHRhYklEKTtcbiAgdGFiTGFiZWwuaW5uZXJIVE1MID0gdGl0bGU7XG4gIGlmIChjb3VudCA9PT0gMCkge1xuICAgIHRhYlJhZGlvLnNldEF0dHJpYnV0ZSgnY2hlY2tlZCcsICdjaGVja2VkJyk7XG4gICAgdGFiTGFiZWwuY2xhc3NMaXN0LmFkZCgndGFiLWxhYmVsLXNlbGVjdGVkJyk7XG4gICAgdGFic0NvbnRhaW5lci5kYXRhc2V0LnNlbGVjdGVkID0gdGFiSUQ7XG4gIH1cblxuICB0YWJSYWRpby5vbmNsaWNrID0gZnVuY3Rpb24gKGUpIHtcbiAgICAvLyByZW1vdmUgc2VsZWN0aW9uIGZyb20gcHJldmlvdXMgbGFiZWxcbiAgICBjb25zdCBsYXN0VmFsID0gdGFic0NvbnRhaW5lci5kYXRhc2V0LnNlbGVjdGVkO1xuICAgIGNvbnN0IHByZXZMYWJlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGxhc3RWYWwgKyAnLWxhYmVsJyk7XG4gICAgcHJldkxhYmVsLmNsYXNzTGlzdC5yZW1vdmUoJ3RhYi1sYWJlbC1zZWxlY3RlZCcpO1xuICAgIC8vIHNlbGVjdCB0aGlzIGxhYmVsXG4gICAgdGFic0NvbnRhaW5lci5kYXRhc2V0LnNlbGVjdGVkID0gdGFiSUQ7XG4gICAgdGFiTGFiZWwuY2xhc3NMaXN0LmFkZCgndGFiLWxhYmVsLXNlbGVjdGVkJyk7XG4gIH07XG5cbiAgLy8gc3R5bGUgY29udGFpbmVyXG4gIGNvZGVUYWIuY2xhc3NMaXN0LmFkZCgnY29kZS10YWInKTtcblxuICAvLyBhZGQgdG9vbGJhciBhbmQgPHByZT4gdGFnIGFuZCBvdXRwdXQgYXJlYVxuICBjb2RlVGFiLmFwcGVuZENoaWxkKFRvb2xiYXIodGFiSUQpKTtcbiAgY29kZVRhYi5hcHBlbmRDaGlsZChwcmVUYWcpO1xuICBjb2RlVGFiLmFwcGVuZENoaWxkKE91dHB1dFBhbmVsKHRhYklELCBvcHRpb25zKSk7XG5cbiAgLy8gYWRkIHRoZSBjb2RlIGNvbnRhaW5lciB0byB0aGUgdGFic1xuICB0YWJzQ29udGFpbmVyLmluc2VydEJlZm9yZSh0YWJMYWJlbCwgdGFic0NvbnRhaW5lci5jaGlsZHJlbltjb3VudF0pO1xuICB0YWJzQ29udGFpbmVyLmFwcGVuZENoaWxkKHRhYlJhZGlvKTtcbiAgdGFic0NvbnRhaW5lci5hcHBlbmRDaGlsZChjb2RlVGFiKTtcbn07XG5cbmNvbnN0IGNyZWF0ZVRhYnNDb250YWluZXIgPSBmdW5jdGlvbiAoZnJhbWVJRCkge1xuICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgY29udGFpbmVyLmlkID0gZnJhbWVJRDtcbiAgY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ2NvZGUtdGFicycpO1xuICByZXR1cm4gY29udGFpbmVyO1xufTtcblxuY29uc3QgZ2V0T3JDcmVhdGVUYWJzQ29udGFpbmVyID0gZnVuY3Rpb24gKGZyYW1lSUQsIHByZVRhZykge1xuICBmcmFtZUlEID0gZnJhbWVJRCB8fCAnbmVwdHVuZS1mcmFtZS0nICsgKGF1dG9Db3VudGVyKyspO1xuICBsZXQgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZnJhbWVJRCk7XG5cbiAgaWYgKGNvbnRhaW5lciA9PSBudWxsKSB7XG4gICAgY29udGFpbmVyID0gY3JlYXRlVGFic0NvbnRhaW5lcihmcmFtZUlEKTtcbiAgICBwcmVUYWcucGFyZW50Tm9kZS5yZXBsYWNlQ2hpbGQoY29udGFpbmVyLCBwcmVUYWcpO1xuICB9IGVsc2Uge1xuICAgIHByZVRhZy5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHByZVRhZyk7XG4gIH1cblxuICByZXR1cm4gY29udGFpbmVyO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAocHJlVGFnLCBjb2RlVGFnKSB7XG4gIC8vIFBhcnNlIG9wdGlvbnMgZnJvbSBtYXJrZG93blxuICBjb25zdCBvcHRpb25zID0gSlNPTi5wYXJzZShjb2RlVGFnLmRhdGFzZXQub3B0aW9ucyk7XG4gIGNvbnN0IGZyYW1lSUQgPSBvcHRpb25zWydmcmFtZSddO1xuICBjb25zdCB0aXRsZSA9IG9wdGlvbnNbJ3RpdGxlJ107XG5cbiAgLy8gQ3JlYXRlIChvciBnZXQgaWYgZXhpc3RzKSB0aGUgdGFicyBmcmFtZSBjb250YWluZXJcbiAgY29uc3QgdGFic0NvbnRhaW5lciA9IGdldE9yQ3JlYXRlVGFic0NvbnRhaW5lcihmcmFtZUlELCBwcmVUYWcpO1xuXG4gIC8vIEFkZCB0aGlzIDxwcmU+PGNvZGU+IHRhZ3MgYXMgYSB0YWIgdG8gdGhlIGNvbnRhaW5lclxuICBjcmVhdGVUYWIodGl0bGUsIHRhYnNDb250YWluZXIsIHByZVRhZywgb3B0aW9ucyk7XG5cbiAgLy8gYWRkIHRyYW5zcGFyZW50IHRleHQgYXJlYSB0aGF0IG1pbWljcyB0aGUgY29kZSB0YWdcbiAgcHJlVGFnLmFwcGVuZENoaWxkKEVkaXRvcihjb2RlVGFnKSk7XG59O1xuIiwiY29uc3Qgc2NvcGVkRXZhbCA9IHJlcXVpcmUoJy4vZXZhbC5qcycpO1xuY29uc3Qgc2VydmVyRXhlYyA9IHJlcXVpcmUoJy4vc2VydmVyRXhlYy5qcycpO1xuXG4vLyBoYW5kbGVzIGNsaWNraW5nIG9uIGFuIGljb24gaW4gdGhlIGNvZGUgdG9vbGJhclxuY29uc3QgdG9vbGJhckNsaWNrID0gZnVuY3Rpb24gKCkge1xuICBjb25zdCB0YWJJRCA9IHRoaXMucGFyZW50Tm9kZS5kYXRhc2V0LnRhYklEO1xuICBjb25zdCB0eXBlID0gdGhpcy5jaGlsZHJlblswXS5jbGFzc0xpc3RbMV0uc3BsaXQoJy0nKVsxXTtcbiAgY29uc3QgY29kZVRhZyA9IHRoaXMucGFyZW50Tm9kZS5wYXJlbnROb2RlLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdjb2RlJylbMF07XG4gIGNvbnN0IHRleHRBcmVhVGFnID0gdGhpcy5wYXJlbnROb2RlLnBhcmVudE5vZGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3RleHRhcmVhJylbMF07XG4gIGNvbnN0IG9wdGlvbnMgPSBKU09OLnBhcnNlKGNvZGVUYWcuZGF0YXNldC5vcHRpb25zKTtcbiAgY29uc3Qgb3V0cHV0UGFuZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0YWJJRCArICctb3V0cHV0Jyk7XG5cbiAgbGV0IHJhbmdlO1xuICBzd2l0Y2ggKHR5cGUpIHtcbiAgICBjYXNlICdjb3B5JzpcbiAgICAgIHdpbmRvdy5nZXRTZWxlY3Rpb24oKS5yZW1vdmVBbGxSYW5nZXMoKTtcbiAgICAgIHJhbmdlID0gZG9jdW1lbnQuY3JlYXRlUmFuZ2UoKTtcbiAgICAgIHJhbmdlLnNlbGVjdE5vZGUoY29kZVRhZyk7XG4gICAgICB3aW5kb3cuZ2V0U2VsZWN0aW9uKCkuYWRkUmFuZ2UocmFuZ2UpO1xuICAgICAgZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ2NvcHknKTtcbiAgICAgIHdpbmRvdy5nZXRTZWxlY3Rpb24oKS5yZW1vdmVBbGxSYW5nZXMoKTtcbiAgICAgIGJyZWFrO1xuXG4gICAgY2FzZSAndHJhc2gnOlxuICAgICAgdGV4dEFyZWFUYWcudmFsdWUgPSAnJztcbiAgICAgIHRleHRBcmVhVGFnLmhhbmRsZXIoKTtcbiAgICAgIGJyZWFrO1xuXG4gICAgY2FzZSAncGxheSc6XG4gICAgICBvdXRwdXRQYW5lbC5yZXNldCgpO1xuICAgICAgaWYgKG9wdGlvbnNbJ2VudiddID09PSAnc2VydmVyJykge1xuICAgICAgICBzZXJ2ZXJFeGVjKGNvZGVUYWcudGV4dENvbnRlbnQsIG9wdGlvbnNbJ3Njb3BlJ10sIHRhYklEKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHNjb3BlZEV2YWwoY29kZVRhZy50ZXh0Q29udGVudCwgb3B0aW9uc1snc2NvcGUnXSwgdGFiSUQpO1xuICAgICAgfVxuICAgICAgYnJlYWs7XG4gIH1cbn07XG5cbi8vIGNyZWF0ZXMgSFRNTCBlbGVtZW50cyBmb3IgdGhlIHRvb2xiYXIgb24gdG9wIG9mIDxjb2RlPiB0YWdzXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uICh0YWJJRCwgaGFuZGxlcj10b29sYmFyQ2xpY2spIHtcbiAgY29uc3QgZWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICBlbGVtZW50LmNsYXNzTGlzdC5hZGQoJ2NvZGUtdG9vbGJhcicpO1xuICBlbGVtZW50LmRhdGFzZXQudGFiSUQgPSB0YWJJRDtcbiAgZWxlbWVudC5pbm5lckhUTUwgPSAnPGEgaHJlZj1cImphdmFzY3JpcHQ6dm9pZCgwKVwiPjxpIGNsYXNzPVwiZmEgZmEtcGxheVwiPjwvaT48L2E+JyArXG4gICAgJzxhIGhyZWY9XCJqYXZhc2NyaXB0OnZvaWQoMClcIj48aSBjbGFzcz1cImZhIGZhLWNvcHlcIj48L2k+PC9hPicgK1xuICAgICc8YSBocmVmPVwiamF2YXNjcmlwdDp2b2lkKDApXCI+PGkgY2xhc3M9XCJmYSBmYS10cmFzaFwiPjwvaT48L2E+JztcblxuICBBcnJheS5mcm9tKGVsZW1lbnQuY2hpbGRyZW4pLm1hcChmdW5jdGlvbiAoYVRhZykge1xuICAgIGFUYWcub25jbGljayA9IGhhbmRsZXI7XG4gIH0pO1xuXG4gIHJldHVybiBlbGVtZW50O1xufTtcbiJdfQ==

    </script>
  </body>
</html>
  
